<div class="container">
  <div class="container-fluid">
    <div class="card">
      <div class="card-header">
        <h3 class="card-title">New Membership Application </h3>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-6">
          </div>
          <div class="col-md-5">
            <%= simple_form_for @membership, multipart: true, html: { autocomplete: 'off' }, url: :membership_applications do |f| %>
              <%= f.error_notification %>
              <%=image_tag("default.png", class: "img-circle", height: 60, width: 60) %>
              <%= f.input :avatar, as: :file, label: "Profile Photo" %>
              <hr>
              <%= f.input :account_number, input_html: { value: SecureRandom.uuid }, as: :hidden %>
              <%= f.input :membership_type, collection: Cooperatives::Membership.membership_types.keys.to_a.map{ |a| [a.titleize, a] }, as: :radio_buttons, checked: Cooperatives::Membership.membership_types.keys.second %>
              <%= f.input :first_name %>
              <%= f.input :middle_name %>
              <%= f.input :last_name %>
              <%= f.input :sex, collection: Member.sexes.keys.to_a.map{|a| [a.titleize, a] }, as: :radio_buttons %>
              <%= f.input :civil_status, collection: Member.civil_statuses.keys.to_a.map{|a| [a.titleize, a] }, as: :radio_buttons %>
              <%= f.input :date_of_birth, as: :string, input_html: { class: "datepicker" } %>
              <%= f.input :contact_number %>
              <%= f.input :email %>
              <%= f.input :tin_number, label: "TIN Number" %>

              <%= f.input :office_id, input_html: { value: current_user.office_id }  %>
              <%= f.input :cooperative_id, input_html: { value: current_user.cooperative_id } %>
              <div class="form-group">
                <%= f.label 'Province' %><br />
                <%= f.collection_select :province_id, Addresses::Province.order(:name), :id, :name, include_blank: true, html: {class: 'form-control'} %>
              </div>
              <div class="form-group">
                <%= f.label "Municipality" %><br />
                <%= f.grouped_collection_select :municipality_id, Addresses::Province.order(:name), :municipalities, :name, :id, :name, include_blank: true %>
              </div>
              <div class="form-group ">
                <%= f.label "Barangay" %><br />
                <%= f.grouped_collection_select :barangay_id, Addresses::Municipality.order(:name), :barangays, :name, :id, :name, include_blank: true %>
              </div>
              <%= f.input :complete_address %>

              <%= f.input :membership_date, as: :string, input_html: { class: "datepicker" } %>
              <%= f.submit "Save Member",  class: "btn btn-primary float-right" %>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
  jQuery(function() {
  var municipalities;
  $('#membership_application_municipality_id').parent().hide();
  $('#membership_application_barangay_id').parent().hide();
  municipalities = $('#membership_application_municipality_id').html();
  console.log(municipalities);
  return $('#membership_application_province_id').change(function() {
    var province, escaped_province, options;
    province = $('#membership_application_province_id :selected').text();
    options = $(municipalities).filter("optgroup[label=" + province + "]").sort().prepend('<option value="">Select Municipality</option>').html();
    console.log(options);
    if (options) {
      $('#membership_application_municipality_id').html(options);
      return $('#membership_application_municipality_id').parent().show();
    } else {
      $('#membership_application_municipality_id').empty();
      $('#membership_application_barangay_id').empty();
      return $('#membership_application_municipality_id').parent().hide();
      return $('#membership_application_barangay_id').parent().hide();
    }
  });
});
</script>

<script type="text/javascript">
  jQuery(function() {
  var barangays;
  $('#membership_application_barangay_id').parent().hide();
  barangays = $('#membership_application_barangay_id').html();
  console.log(barangays);
  return $('#membership_application_municipality_id').change(function() {
    var municipality, escaped_municipality, options;
    municipality = $('#membership_application_municipality_id :selected').text();
    options = $(barangays).sort().filter("optgroup[label=" + municipality + "]").sort().prepend('<option value="">Select Barangay</option>').html();
    console.log(options);
    if (options) {
      $('#membership_application_barangay_id').html(options);
      return $('#membership_application_barangay_id').parent().show();
    } else {
      $('#membership_application_barangay_id').empty();
      return $('#membership_application_barangay_id').parent().hide();
    }
  });
});
</script>

<script type="text/javascript">
  $('#membership_application_barangay_id').change(function() {
    var province, municipality, barangay, complete_address
    province = $('#membership_application_province_id :selected').text();
    municipality = $('#membership_application_municipality_id :selected').text();
    barangay = $('#membership_application_barangay_id :selected').text();
    complete_address = [barangay, municipality, province].join(", ");
    $("#membership_application_complete_address").val(complete_address);
  });
  $('#membership_application_municipality_id').change(function() {
    var province, municipality, complete_address
    province = $('#membership_application_province_id :selected').text();
    municipality = $('#membership_application_municipality_id :selected').text();
    complete_address = [municipality, province].join(", ");
    $("#membership_application_complete_address").val(complete_address);
  });
</script>

<script type="text/javascript">
$(document).ready(function() {
  $("#membership_application_membership_type").select2({
    theme: "bootstrap"
  });
  $("#membership_application_civil_status").select2({
    theme: "bootstrap"
  });
  $("#membership_application_sex").select2({
    theme: "bootstrap"
  });
  $("#membership_application_province_id").select2({
    theme: "bootstrap",
    width: "100%"
  });
  $("#membership_application_municipality_id").select2({
    theme: "bootstrap",
    width: "100%"
  });
  $("#membership_application_barangay_id").select2({
    theme: "bootstrap",
    width: "100%"
  });
});
</script>
