<div class="row">
  <div class="col-md-6">
    <div class="box box-solid">
      <div class="box-header">
        <div class="row">
          <div class="col-md-8">
            <%=form_tag savings_accounts_path, method: :get, class: "search-form" do %>
                <div class="input-group">
                  <%= text_field_tag :search, params[:search], class: "form-control", placeholder: "Search Account Number ", id: 'account-search-form' %>
                  <span class="input-group-btn">
                    <%= button_tag(type: 'submit', id: "search-btn", class: "btn btn-flat") do %>
                      <i class="fa fa-search"></i>
                    <% end %>
                  </span>
                </div>
              <% end %>
            </div>
            <div class="col-md-4">
              <%= link_to 'New Account', new_treasury_module_savings_account_path, class: "btn btn-primary" %>
            </div>
          </div>
      </div>

      <div class="box-body">
        <% @savings_accounts.each do |savings_account| %>
          <%=link_to savings_account_path(savings_account) do %>
            <% cache savings_account do %>
              <div class="row">
                <div class="col-md-2">
                  <center> <%=image_tag(savings_account.depositor.avatar.url(:medium), style: 'width:60px;height:60px;', class: 'media-object img-circle') %></center>
                </div>
                <div class="col-md-5">
                  <p class=""><%= savings_account.depositor.name.try(:upcase) %></p>
                  <small class=""> <%= savings_account.saving_product_name %></small><br><br>
                  <% if !savings_account.closed? %>
                    <% if policy([:savings_accounts, :deposit]).new? %>
                      <%= link_to 'Deposit', new_savings_account_deposit_path(savings_account), class: "btn btn-xs btn-success" %>
                    <% end %>
                       &nbsp; &nbsp;
                    <% if policy([:savings_accounts, :withdrawal]).new? %>
                      <%= link_to 'Withdraw', new_savings_account_withdrawal_path(savings_account), class: "btn btn-xs btn-warning" %>
                    <% end %>
                  <% end %>

                  <br>
                </div>
                <div class="col-md-3">
                  <h4 class="text-muted"><center><%=number_to_currency savings_account.balance %></center></h4>
                </div>
                <div class="col-md-2">
                  <% if savings_account.closed? %>
                    <span class="badge bg-red"> Closed </span>
                  <% end %>
                </div>
              </div>
              <hr>
            <% end %>
          <% end %>
        <% end %>
        <center><%= will_paginate @savings_accounts %> </center>
      </div>
    </div>
  </div>
  <div class="col-md-6">
    <div  class="box box-default">
      <div class="box-header">
        <small>METRICS</small>
        <% if  @metric.negative? %>
        <h1 class="text-danger"><%= number_to_currency @metric %> % <span class="fa fa-arrow-down"></span></h1>
        <% elsif @metric.positive? %>
        <h1 class="text-success"><%= number_to_currency @metric %> % <span class="fa fa-arrow-up"></span></h1>

        <% end %>
        <small>SINCE <%= Date.today.last_month.end_of_month.strftime("%B %e, %Y") %></small>
        <hr />
        <h4>BALANCES / YEAR </h4>
        <% year_dates = [] %>
        <% start_date = MembershipsModule::Saving.order(date_opened: :desc).last.date_opened %>
        <% (start_date.to_date..Date.today).each do |date| %>

          <% year_dates << date.end_of_year%>
        <% end %>
        <% savings_balances_data = [] %>
        <% year_dates.uniq.each do |year| %>
        <% savings_balances_data << { year.end_of_year.strftime("%B %Y") => CoopServicesModule::SavingProduct.total_balances(to_date: year.end_of_year) } %>
        <% end %>
        <%= line_chart (Hash[*savings_balances_data.collect{|h| h.to_a}.flatten].delete_if{|k,v| v.blank?}),messages: {empty: "No data"} %>

      </div>

    </div>
  </div>
</div>
