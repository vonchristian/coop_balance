<div class="row">
  <div class="col-md-8">
    <div class="card">
      <div class="card-header">
        <div class="row">
          <div class="col-md-4 col-sm-4">
            <h4 class="card-title text-success">Cash Receipts</h4>
          </div>
          <div class="col-md-8 col-sm-8 text-right">
            <small><%= @cash_account.name.upcase %></small>
            <h3 class="card-title"> <%= number_to_currency @cash_account.balance %></h3>
          </div>
        </div>
      </div>
      <div class="card-body">
        <%= simple_form_for @cash_receipt_line_item, url: :treasury_module_cash_account_cash_receipt_line_items, html: { autocomplete: 'off' } do |f| %>
          <%= f.input :amount_type, input_html: { value: 'credit' }, as: :hidden %>
          <div class="row">
            <div class="col-md-6">
              <%= f.input :account_id, label: false, placeholder: "Account", collection: AccountingModule::Account.all.map{|a| [a.name, a.id] }, prompt: "Select Account" %>
              <%= f.input :employee_id, input_html: { value: current_user.id }, as: :hidden %>
              <%= f.input :cash_account_id, input_html: { value: @cash_account.id }, as: :hidden %>

            </div>
            <div class="col-md-4">
              <%= f.input :amount, label: false, placeholder: 'Amount', as: :currency  %>
            </div>
            <div class="col-md-2">
              <%= f.submit "Add", class: "btn btn-primary", data: { disable_with: "Adding..." } %>
            </div>
          </div>
        <% end %>

        <table class="table table-hover">
          <thead>
            <tr>
              <th>DEBIT</th>
              <th>ACCOUNT</th>
              <th class="text-right">CREDIT</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            <% current_user.voucher_amounts.each do |amount| %>
              <tr>
                <td>
                  <% if amount.debit? %>
                    <%= number_to_currency amount.amount %>
                  <% end %>
                </td>

                <td><%= amount.account_name %></td>

                <td class="text-right">
                  <% if amount.credit? %>
                    <%= number_to_currency amount.amount %>
                  <% end %>
                </td>
                <td class="text-right">
                  <%= link_to treasury_module_cash_account_cash_receipt_line_item_path(id: @cash_account.id, amount_id: amount.id, employee_id: current_user.id), method: :delete do %>
                    <span title="Remove" data-toggle="tooltip" class="fa fa-trash text-danger"></span>
                  <% end %>
                </td>
              </tr>
            <% end %>
            <tr>
              <th><%= number_to_currency current_user.voucher_amounts.debit.sum(&:amount) %></th>
              <th></th>
              <th class="text-right"><%= number_to_currency current_user.voucher_amounts.credit.sum(&:amount) %></th>
              <th></th>
            </tr>
          </tbody>
        </table>

      </div>
    </div>
  </div>
  <% if current_user.voucher_amounts.present? %>
    <div class="col-md-4">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title"> Payee Details </h3>
        </div>
        <div class="card-body">
          <%=simple_form_for @cash_receipt, url: :treasury_module_cash_receipt_voucher_processings, html: { autocomplete: 'off' } do |f| %>
            <%= f.input :cooperative_service_id, collection: current_cooperative.cooperative_services.map{|a| [a.title, a.id] } %>
            <%= f.input :date, as: :string, input_html: { class: "datepicker" } %>
            <%= f.input :description, as: :text %>
            <%= f.input :reference_number %>
            <%= f.input :account_number, input_html: { value: SecureRandom.uuid }, as: :hidden %>
            <%= f.input :payee_id, label: "Payee", collection: Voucher.payees.map{|a| [a.name, a.id] } %>
            <%= f.input :employee_id, input_html: { value: current_user.id }, as: :hidden %>
            <%= f.input :cash_account_id, input_html: { value: @cash_account.id }, as: :hidden %>
            <hr>
            <% if current_user.voucher_amounts.present? %>
              <%= f.submit "Proceed", class: "btn btn-primary btn-block", data: { disable_with: "Processing"} %>
            <% end %>

          <% end %>
        </div>
      </div>
    </div>
  </div>
<% end %>
</div>
<script type="text/javascript">
  $(document).ready(function() {
    $("#vouchers_voucher_amount_processing_account_id").select2({
      theme: "bootstrap"
    });

    $("#vouchers_voucher_processing_cooperative_service_id").select2({
      theme: "bootstrap"
    });

    $("#vouchers_voucher_processing_payee_id").select2({
      theme: "bootstrap"
    });

  });
</script>
