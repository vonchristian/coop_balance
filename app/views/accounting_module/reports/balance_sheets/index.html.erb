
<div class="container">
  <div class="card">
    <div class="card-header">
      <div class="row">
        <div class="col-md-3">
          <h3 class="title-up"> Balance Sheet - <%= @office.name %> </h3>
          <p class="text-muted"> As of <%= @to_date.strftime("%B %e, %Y") %></p>
          <% current_cooperative.offices.each do |office| %>
            <%= link_to office.name, accounting_module_reports_balance_sheets_path(office_id: office.id), class: 'btn btn-outline-primary' %>
          <% end %>
        </div>
        <div class="col-md-6">
          <%= form_tag({:action => 'index'}, {:method => :get, :class => 'form-inline'}) do%>
            <div class="form-group">
            <%= label_tag :to_date, nil, class: 'sr-only'%>
            <%= text_field_tag :to_date, @to_date.strftime("%B %e, %Y"), :class => 'datepicker form-control' %>
            </div>
            <button type="submit" class="btn btn-primary">Generate</button>
          <% end %>
        </div>
        <div class="col-md-3">
          Export To:
          <%= link_to accounting_module_reports_balance_sheets_path(office_id: @office.id, to_date: @to_date, format: 'xlsx') do %>
            <span class="btn btn-outline-secondary btn-sm"><i class="fa fa-spreadsheet"></i> Excel </span>
          <% end %>
          <%= link_to accounting_module_reports_balance_sheets_path(format: 'pdf', to_date: @to_date) do %>
            <span class="btn btn-outline-secondary btn-sm"><i class="fa fa-pdf"></i> PDF </span>
          <% end %>

        </div>
      </div>
    </div>
    <div class="card-body">
      <br>
      <b>ASSETS </b><br>
      <% assets_total = 0 %>
      <% current_cooperative.account_categories.asset.each do |category| %>
      <% category_total  = 0 %>


        <div class="row min-margin">
                  <div class="col-md-5">
                    <%= category.title %>
                  </div>
                  <div class="col-md-3">

                  </div>
                </div>
                <% category.accounts.each do |account| %>
                <% assets_total += account.balance(to_date: @to_date) %>
                <% category_total += account.balance(to_date: @to_date) %>

                 <div class="row">
        <div class="col-md-5">
          &nbsp; &nbsp; <%= account.name %>
      </div>
      <div class="col-md-3">
        <span class="float-right">
          <%= number_to_currency account.balance(to_date: @to_date) %>
          </span>
        </div>
    </div>
      <% end %>
          <% category.sub_categories.each do |sub_category| %>
            &nbsp; &nbsp; <%= sub_category.title %><br>
              <% sub_category_sub = 0 %>
              <% sub_category.accounts.each do |account| %>
                <% sub_category_sub += account.balance(to_date: @to_date) %>
                <% category_total += account.balance(to_date: @to_date) %>
                <% assets_total += account.balance(to_date: @to_date) %>



                <div class="row min-margin">
                  <div class="col-md-5">
                    &nbsp; &nbsp;  &nbsp; &nbsp; <%= account.name %>
                  </div>
                  <div class="col-md-3">
                    <span class="float-right"><%= number_to_currency account.balance(to_date: @to_date) %></span>
                  </div>
                </div>
               <% end %>

            <% sub_category.sub_categories.each do |sub1_category| %>
              <% sub1_total = 0 %>
               &nbsp; &nbsp;  &nbsp; &nbsp; <%= sub1_category.title %>
                <% sub1_category.accounts.each do |sub_account| %>
                <% sub_category_sub += sub_account.balance(to_date: @to_date) %>
                <% category_total += sub_account.balance(to_date: @to_date) %>
                <% sub1_total += sub_account.balance(to_date: @to_date) %>
                <% assets_total += sub_account.balance(to_date: @to_date) %>


              <div class="row min-margin">
                <div class="col-md-5">
                  &nbsp; &nbsp;  &nbsp; &nbsp; &nbsp; &nbsp; <%= sub_account.name %>
                </div>
                <div class="col-md-3">
                  <span class="float-right"><%= number_to_currency sub_account.balance(to_date: @to_date) %></span>
                </div>
              </div>
            <% end %>
            <hr>
            <div class="row min-margin">
                <div class="col-md-5">
                  &nbsp; &nbsp;  &nbsp; &nbsp; Total <%= sub1_category.title %>
                </div>
                <div class="col-md-3">
                  <span class="float-right"><%= number_to_currency sub1_total %></span>
                </div>
              </div>
            <% end %>
            <hr>
            <div class="row min-margin">
              <div class="col-md-5">
                &nbsp; &nbsp;  Total <%= sub_category.title %>
              </div>
               <div class="col-md-3">
                <span class="float-right">
                  <%= number_to_currency sub_category_sub %>
                </span>
              </div>
            </div>
          <% end %>
          <hr>
          <div class="row min-margin">
            <div class="col-md-5">
             Total <%= category.title %>
            </div>
            <div class="col-md-3">
              <span class="float-right"><%= number_to_currency category_total %></span>
            </div>
          </div>
      <% end %>
      <hr>
      <div class="row">
        <div class="col-md-5">
          TOTAL ASSETS
        </div>
        <div class="col-md-3">
          <span class="float-right">
            <%= number_to_currency assets_total  %>

          </span>
        </div>
      </div>
      <hr>

      <b>LIABILITIES, EQUITY AND RESERVE </b><br>
<% liabilities_total = 0 %>
<% equity_total = 0 %>

      <% current_cooperative.account_categories.liability.each do |category| %>
      <% category_total  = 0 %>


        <div class="row min-margin">
                  <div class="col-md-5">
                    <%= category.title %>
                  </div>
                  <div class="col-md-3">

                  </div>
                </div>
                  <% category.accounts.each do |account| %>
                  <% liabilities_total += account.balance(to_date: @to_date) %>
                  <% category_total += account.balance(to_date: @to_date) %>

      <div class="row">
        <div class="col-md-5">
          &nbsp; &nbsp; <%= account.name %>
      </div>
      <div class="col-md-3">
        <span class="float-right">
          <%= number_to_currency account.balance(to_date: @to_date) %>
          </span>
        </div>
    </div>
      <% end %>

          <% category.sub_categories.each do |sub_category| %>
            &nbsp; &nbsp;<%= sub_category.title %><br>
              <% sub_category_sub = 0 %>
              <% sub_category.accounts.each do |account| %>
                <% sub_category_sub += account.balance(to_date: @to_date) %>
                <% category_total += account.balance(to_date: @to_date) %>
                <% assets_total += account.balance(to_date: @to_date) %>


                <div class="row min-margin">
                  <div class="col-md-5">
                    &nbsp; &nbsp;  &nbsp; &nbsp; <%= account.name %>
                  </div>
                  <div class="col-md-3">
                    <span class="float-right"><%= number_to_currency account.balance(to_date: @to_date) %></span>
                  </div>
                </div>
               <% end %>

            <% sub_category.sub_categories.each do |sub1_category| %>
              <% sub1_total = 0 %>
               &nbsp; &nbsp;  &nbsp; &nbsp; <%= sub1_category.title %>
                <% sub1_category.accounts.each do |sub_account| %>
                <% sub_category_sub += sub_account.balance(to_date: @to_date) %>
                <% category_total += sub_account.balance(to_date: @to_date) %>
                <% sub1_total += sub_account.balance(to_date: @to_date) %>
                <% assets_total += sub_account.balance(to_date: @to_date) %>


              <div class="row min-margin">
                <div class="col-md-5">
                  &nbsp; &nbsp;  &nbsp; &nbsp; &nbsp; &nbsp; <%= sub_account.name %>
                </div>
                <div class="col-md-3">
                  <span class="float-right"><%= number_to_currency sub_account.balance(to_date: @to_date) %></span>
                </div>
              </div>
            <% end %>
            <hr>
            <div class="row min-margin">
                <div class="col-md-5">
                  &nbsp; &nbsp;  &nbsp; &nbsp; Total <%= sub1_category.title %>
                </div>
                <div class="col-md-3">
                  <span class="float-right"><%= number_to_currency sub1_total %></span>
                </div>
              </div>
            <% end %>
            <hr>
            <div class="row min-margin">
              <div class="col-md-5">
                &nbsp; &nbsp;  Total <%= sub_category.title %>
              </div>
               <div class="col-md-3">
                <span class="float-right">
                  <%= number_to_currency sub_category_sub %>
                </span>
              </div>
            </div>
          <% end %>
          <hr>
          <div class="row min-margin">
            <div class="col-md-5">
             Total <%= category.title %>
            </div>
            <div class="col-md-3">
              <span class="float-right"><%= number_to_currency category_total %></span>
            </div>
          </div>
      <% end %>
      <hr>

<% current_cooperative.account_categories.equity.each do |category| %>
      <% category_total  = 0 %>


        <div class="row min-margin">
                  <div class="col-md-5">
                    <%= category.title %>
                  </div>
                  <div class="col-md-3">

                  </div>
                </div>
                  <% category.accounts.each do |account| %>
                  <% equity_total += account.balance(to_date: @to_date) %>
                  <% category_total += account.balance(to_date: @to_date) %>

      <div class="row">
        <div class="col-md-5">
          &nbsp; &nbsp; <%= account.name %>
      </div>
      <div class="col-md-3">
        <span class="float-right">
          <%= number_to_currency account.balance(to_date: @to_date) %>
          </span>
        </div>
    </div>
      <% end %>

          <% category.sub_categories.each do |sub_category| %>
            &nbsp; &nbsp;<%= sub_category.title %><br>
              <% sub_category_sub = 0 %>
              <% sub_category.accounts.each do |account| %>
                <% sub_category_sub += account.balance(to_date: @to_date) %>
                <% category_total += account.balance(to_date: @to_date) %>
                <% assets_total += account.balance(to_date: @to_date) %>


                <div class="row min-margin">
                  <div class="col-md-5">
                    &nbsp; &nbsp;  &nbsp; &nbsp; <%= account.name %>
                  </div>
                  <div class="col-md-3">
                    <span class="float-right"><%= number_to_currency account.balance(to_date: @to_date) %></span>
                  </div>
                </div>
               <% end %>

            <% sub_category.sub_categories.each do |sub1_category| %>
              <% sub1_total = 0 %>
               &nbsp; &nbsp;  &nbsp; &nbsp; <%= sub1_category.title %>
                <% sub1_category.accounts.each do |sub_account| %>
                <% sub_category_sub += sub_account.balance(to_date: @to_date) %>
                <% category_total += sub_account.balance(to_date: @to_date) %>
                <% sub1_total += sub_account.balance(to_date: @to_date) %>
                <% assets_total += sub_account.balance(to_date: @to_date) %>


              <div class="row min-margin">
                <div class="col-md-5">
                  &nbsp; &nbsp;  &nbsp; &nbsp; &nbsp; &nbsp; <%= sub_account.name %>
                </div>
                <div class="col-md-3">
                  <span class="float-right"><%= number_to_currency sub_account.balance(to_date: @to_date) %></span>
                </div>
              </div>
            <% end %>
            <hr>
            <div class="row min-margin">
                <div class="col-md-5">
                  &nbsp; &nbsp;  &nbsp; &nbsp; Total <%= sub1_category.title %>
                </div>
                <div class="col-md-3">
                  <span class="float-right"><%= number_to_currency sub1_total %></span>
                </div>
              </div>
            <% end %>
            <hr>
            <div class="row min-margin">
              <div class="col-md-5">
                &nbsp; &nbsp;  Total <%= sub_category.title %>
              </div>
               <div class="col-md-3">
                <span class="float-right">
                  <%= number_to_currency sub_category_sub %>
                </span>
              </div>
            </div>
          <% end %>
          <hr>
          <div class="row min-margin">
            <div class="col-md-5">
             Total <%= category.title %>
            </div>
            <div class="col-md-3">
              <span class="float-right"><%= number_to_currency category_total %></span>
            </div>
          </div>
      <% end %>
      <hr>

      <hr>
      <div class="row">
        <div class="col-md-5">
          <b>TOTAL LIABILITIES AND EQUITY </b>
        </div>
        <div class="col-md-3">
          <span class="float-right">
            <%= number_to_currency equity_total + liabilities_total %>
          </span>
        </div>
        </div>


<div class="card">
  <div class="card-header">
    <div class="row">
      <div class="col-md-9">
        <h3 class="card-title"> Balance Sheet </h3>
        <p class="text-muted"> As of <%= @to_date.strftime("%B %e, %Y") %></p>
      </div>
      <div class="col-md-3">

      </div>
    </div>
  </div>
  <div class="card-body">
    <div class="row">
      <div class="col-md-9">
        <%= form_tag({:action => 'index'}, {:method => :get, :class => 'form-inline'}) do%>
          <div class="form-group">
          <%= label_tag :to_date, nil, class: 'sr-only'%>
          <%= text_field_tag :to_date, @to_date.strftime("%B %e, %Y"), :class => 'datepicker form-control' %>
          </div>
          <button type="submit" class="btn btn-primary">Generate</button>
        <% end %>
      </div>
      <div class="col-md-3">
        <%= link_to "View (PDF)", accounting_module_reports_balance_sheets_path(format: 'pdf', to_date: @to_date), class: "btn btn-default" %>
      </div>
    </div>
  </div>
  <hr class="no-margin">
  <div class="card-body">
    <%= render 'accounting_module/accounts/account', :name => "Assets", :accounts => @assets %>
    <%= render 'accounting_module/accounts/account', :name => "Liabilities", :accounts => @liabilities %>
    <%= render 'accounting_module/accounts/account', :name => "Equity", :accounts => @equity %>
</div>
