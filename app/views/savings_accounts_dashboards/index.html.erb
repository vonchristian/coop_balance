<div class="container-fluid">
  <div class="row">
    <div class="col-xs-12">
      <div class="box box-solid">
        <div class="box-body">
          <ul class="nav nav-tabs">
            <ul class="nav nav-tabs">
              <li class="<%='active' if current_page?(savings_accounts_path(from_date: nil, to_date: nil)) %>"><%=link_to 'All Savings', savings_accounts_path %></li>
              <li class="<%='active' if current_page?(savings_accounts_path(from_date: Date.today - 30.days, to_date: Date.today))%>"><%=link_to '1 - 30 Days Inactive', savings_accounts_path(from_date: Date.today - 30.days, to_date: Date.today) %></li>
            <li class="<%='active' if current_page?(savings_accounts_path(from_date: Date.today - 60.days, to_date: Date.today - 31.days))%>"><%=link_to '31 - 60 Days Inactive', savings_accounts_path(from_date: Date.today - 60.days, to_date: Date.today - 31.days) %></li>
              <li class="<%='active' if current_page?(savings_accounts_path(from_date: Date.today - 90.days, to_date: Date.today - 61.days))%>"><%=link_to '61 - 90 Days Inactive', savings_accounts_path(from_date: Date.today - 90.days, to_date: Date.today - 61.days) %></li>
              <li class="<%='active' if current_page?(savings_accounts_path(from_date: Date.today - 363.days, to_date: Date.today - 91.days))%>"><%=link_to 'Over 1 Year', savings_accounts_path(from_date: Date.today - 999.years, to_date: Date.today - 363.days) %></li>
              <li class="<%='active' if current_page?(savings_accounts_below_minimum_balances_path)%>"><%=link_to 'Below Min. Balance', savings_accounts_dashboards_path %></li>
              <li class="<%='active' if current_page?(savings_accounts_dashboards_path)%>"><%=link_to 'Dashboard', savings_accounts_dashboards_path %></li>


          </ul>
          <br />
          <div class="row">
            <div class="col-md-8">

            </div>
            <div class="col-md-4">

            </div>
          </div>
          <div class="row">
                  <div class="col-md-6">
                    <h3><%= number_to_currency CoopServicesModule::SavingProduct.total_balances %></h3>
                    <small>TOTAL SAVINGS</small>
                  </div>
                  <div class="col-md-3">
                    <small>METRICS</small>
                    <h3 class="text-<%= CoopServicesModule::SavingProduct.metric_color%>"><i class="fa fa-arrow-<%=CoopServicesModule::SavingProduct.metric_chevron%>"></i> <%= number_to_currency CoopServicesModule::SavingProduct.metric(first_date: Date.today, second_date: Date.today.last_month), unit: "" %> % </h3>
                    <small>SINCE LAST MONTH (<%= Date.today.last_month.strftime("%B %e, %Y") %>)</small>
                  </div>
                </div>
                <hr>

          <h4>Savings Accounts Inactivity</h4>
          <div class="row">
            <div class="col-md-8">
              <% savings_inactivity_data = [] %>
              <% savings_inactivity_data << { "1-30 Days Inactive" => @savings_accounts.updated_at(from_date: Date.today - 30.days, to_date: Date.today).count } %>
              <% savings_inactivity_data << { "31-60 Days Inactive" => @savings_accounts.updated_at(from_date: Date.today - 60.days, to_date: Date.today - 31.days).count } %>
              <% savings_inactivity_data << { "31-60 Days Inactive" => @savings_accounts.updated_at(from_date: Date.today - 60.days, to_date: Date.today - 31.days).count } %>
              <% savings_inactivity_data << { "61-90 Days Inactive" => @savings_accounts.updated_at(from_date: Date.today - 90.days, to_date: Date.today - 61.days).count } %>
              <% savings_inactivity_data << { "91-363 Days Inactive" => @savings_accounts.updated_at(from_date: Date.today - 363.days, to_date: Date.today - 91.days).count } %>


              <% savings_inactivity_data << { "Over 1 Year Inactive" => @savings_accounts.updated_at(from_date: Date.today - 999.years, to_date: Date.today - 364.days).count } %>





              <%= pie_chart (Hash[*savings_inactivity_data.collect{|h| h.to_a}.flatten].delete_if{|k,v| v.blank?}),messages: {empty: "No data"}, download: true %>
            </div>
            <div class="col-md-4">
              <h5><i class="fa fa-chart-pie"></i> INACTIVITY STATISTICS</h5>
              <div class="row">
                <div class="col-md-8">
                  1-30 Days Inactive
                </div>
                <div class="col-md-3">
                  <%= @savings_accounts.updated_at(from_date: Date.today - 30.days, to_date: Date.today.yesterday).size %>

                </div>
              </div>
              <br />
              <hr />
              <div class="row">
                <div class="col-md-8">
                  31-60 Days Inactive
                </div>
                <div class="col-md-3">
                  <%= @savings_accounts.updated_at(from_date: Date.today - 60.days, to_date: Date.today - 31.days).count %>
                </div>
              </div>
              <br />
              <div class="row">
                <div class="col-md-8">
                  61-90 Days Inactive
                </div>
                <div class="col-md-3">
                  <%= @savings_accounts.updated_at(from_date: Date.today - 90.days, to_date: Date.today - 61.days).size %>
                </div>
              </div>
              <br />
              <div class="row">
                <div class="col-md-8">
                  91-363 Days Inactive
                </div>
                <div class="col-md-3">
                  <%= @savings_accounts.updated_at(from_date: Date.today - 363.days, to_date: Date.today - 91.days).size %>
                </div>
              </div>
              <br />
              <div class="row">
                <div class="col-md-8">
                  Over 1 Year Inactive
                </div>
                <div class="col-md-3">
                  <%= @savings_accounts.updated_at(from_date: Date.today - 999.years, to_date: Date.today - 364.days).size %>
                </div>
              </div>
              <hr />
              <div class="row">
                <div class="col-md-8">
                  Total Savings Accounts
                </div>
                <div class="col-md-3">
                  <%= @savings_accounts.size %>
                </div>
              </div>
            </div>
          </div>
        </div>
          <div class="box-body">
            <h4>Savings Accounts Transactions / Month</h4>
            <%= line_chart @savings_accounts.group_by_quarter(:updated_at).count, download: true, curve: false %>
            <hr>
            <h4>Balances vs Month </h4>
<% months = [] %>
      <% (DateTime.now.beginning_of_year..DateTime.now).each do |month| %>
       <% months << month.beginning_of_month %>
      <% end %>
      <% balances_data = [] %>
      <% months.uniq.each do |month| %>

        <% balances_data << { month.strftime("%B %Y") => CoopServicesModule::SavingProduct.total_balances(to_date: month.end_of_month) } %>
      <% end %>

<%= line_chart (Hash[*balances_data.collect{|h| h.to_a}.flatten].delete_if{|k,v| v.blank?}),messages: {empty: "No data"}, download: true, curve: false, thousands: "," %>
