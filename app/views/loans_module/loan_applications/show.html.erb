<div class="row">
  <div class="col-md-6">
    <div class="box box-solid">
      <div class="box-header with-border">
        <h3 class="box-title">Loan Application Details </h3>
      </div>
      <div class="box-body">
		<div class="row">
		  <div class="col-md-12">
				<h4 class="loan-amount-applied">Applied Amount <%= number_to_currency @loan.loan_amount %></h4>
				<hr>
				<p class="text-danger">Less Charges</p>
				<% @loan.loan_charges.each do |loan_charge| %>
				  <div class="row">
				    <div class="col-md-5 col-md-offset-1">
					    <%= loan_charge.chargeable.try(:name) %>
					  </div>
					  <div class="col-md-3">
					    <% if loan_charge.charge_adjustment.present? %>
					    <strike class="text-danger pull-right"><%= number_to_currency loan_charge.charge_amount, class: "pull-right" %></strike><br>
					    <%= number_to_currency loan_charge.charge_adjustment.charge_amount %>
					    <span class="text-danger"><%= number_to_currency loan_charge.balance%></span>
					    <% else %>
					      <span class="pull-right"><%= number_to_currency loan_charge.charge_amount %></span>

					    <% end %>
					  </div>
					  <div class="col-md-2">
					    <%= link_to new_loans_module_loan_charge_adjustment_path(loan_charge), class: "btn btn-default btn-xs" do %>
                <span data-toggle="tooltip" title="Adjust Charge" class="text-warning"><i class="fa fa-pencil"></i> </span>
              <% end %> &nbsp;
					    <% if !loan_charge.regular? %>
					      <%= link_to loans_module_loan_charge_path(loan_charge), title: "Remove Charge", method: :delete do %>
                <span data-toggle="tooltip" title="Remove Charge" class="text-danger"><i class="fa fa-trash"></i> </span>
              <% end %>
					    <% end %>

					  </div>
					 </div>
					 <br>
  
				<% end %>
				<%= link_to 'Add', new_loans_module_loan_additional_charge_path(@loan) %>				
        <% @loan.loan_additional_charges.all.each do |charge| %>
				  <div class="row">
				    <div class="col-md-6">
				      <%= charge.name %>
				    </div>
				    <div class="col-md-6">
				      <%= number_to_currency charge.amount %>
				    </div>
				  </div>
				    <br>
				  <% end %>
				<div class="row">
				  <div class="col-md-6">
				    <h4> Total Charges </h4>
				  </div>
				  <div class="col-md-6">
					  <%= number_to_currency @loan.total_loan_charges %>
					</div>
			  </div>
				 <h4>Net <%= number_to_currency @loan.net_proceed %></h4>
				 <hr>
				 
				 <hr>
				 <%= link_to 'Process Loan', loans_module_loan_processings_path(@loan), method: :create, class: "btn  btn-lg btn-success" %>
			</div>
		</div>
	</div>
	</div>
	</div>

			<div class="col-md-6">
      <div class="row">
          <div class="col-md-6 border-right">
            <div class="box box-primary">
            <%= number_to_currency @loan.amortization_schedules.order(created_at: :asc).first.total_amortization %>
            <h4 class="title"> Monthly Payment </h4>
          </div>
          </div>
          <div class="col-md-6 border-left">
          <div class="box box-primary">
            <h4><%= @loan.term %></h4>
            <h4 class="title"> Number of Payments </h4>
          </div>
          </div>
         </div>
			  <%= simple_form_for @loan, url: :loans_module_loan_application do |f| %>
		  <%= f.error_notification %>
		  <%= f.input :loan_product_id, collection: LoansModule::LoanProduct.all.map{|a| [a.name.titleize, a.id] }, as: :radio_buttons %>
		  <%= f.input :member_id, collection: Member.all.map {|a| [a.full_name, a.id] } %>
		  <%= f.input :loan_amount %>
		  <%= f.input :term, label: "Loan Term (in months)" %>
      <%= f.input :mode_of_payment, collection: LoansModule::Loan.mode_of_payments.keys.to_a.map{ |a| [a.titleize, a] }, as: :radio_buttons %>
		  <%= f.input :application_date, as: :string, input_html: { class: "datepicker" } %>
		  <%= f.submit "Calculate", class: "btn btn-primary" %>
		  <hr>
		<% end %>
		</div>
		<div class="table">
		  <table class="table table-striped table-hover">
      <thead>
        <tr>
          <th>Date</th>
          <th>Principal</th>
          <th>Interest</th>
          <th>Total Amortization </th>
          <th>Balance</th>
        </tr>
      </thead>
		    <tbody>
		<% @loan.amortization_schedules.order(created_at: :asc).each do |schedule| %>
		  <tr>
		  <td><%= schedule.date.strftime("%B %e, %Y") %></td>
		  <td><%= number_to_currency schedule.principal %></td>
      <td><%= number_to_currency schedule.interest %> </td>
      <td><%= number_to_currency schedule.try(:total_amortization) %> </td>
		  <td><%= number_to_currency @loan.balance_for(schedule) %></td>
		  </tr>
		<% end %>
		</tbody>
		</table>
		</div>
