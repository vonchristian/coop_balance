<%= simple_form_for @loan, url: :loans_module_loan_applications do |f| %>
<%= f.error_notification %>
  <%= f.input :loan_product_id, label: "Select Loan Product", collection: LoansModule::LoanProduct.all.map{|a| [a.name.titleize, a.id] }, prompt: "Select Type of Loan" %>
  <%= f.input :member_id, collection: Member.all.map {|a| [a.full_name, a.id] } %>
  <%= f.input :loan_amount %>
  <%= f.input :mode_of_payment, collection: LoansModule::Loan.mode_of_payments.keys.to_a.map{ |a| [a.titleize, a] }, as: :radio_buttons %>
  <%= f.input :term, label: "Loan Term (in months)" %>
  <%= f.input :preparer_id, input_html: { value: current_user.id }, as: :hidden %>
  <%= f.submit "Calculate", class: "btn btn-primary" %>
  <hr>
<% end %>
   <p> Interest on Loan </p>
   <div id='loan-interest'></div>
  <% @loan_product.charges.each do |charge| %>
    <p><%= charge.name %>
    <% if charge.amount_type? %>
      <%= charge.amount %>
    <% elsif charge.percent_type? %>
      <div class="<%= charge.id.parameterize.underscore %>"><%= charge.percent %> %</div>
      <div id='<%=charge.id %>'></div>
</p>
    <% end %>

  <% end %>

<% end %>


<script type="text/javascript">

	function calculateLoanCharges() {

	  var loan_amount = document.getElementById('loan-amount').value;
		<% @loan_product.charges.percent_type.each do |charge| %>
	  var <%=charge.name.sub(" ", "_")%> = parseInt($('.<%=charge.id.parameterize.underscore%>').text());

	  var <%=charge.name.downcase.parameterize.underscore%> = loan_amount * (<%=charge.name.sub(" ", "_")%>/100);
	  document.getElementById('<%=charge.id%>').innerHTML = <%=charge.name.downcase.parameterize.underscore%>;
	  	<% end %>
	}

</script>
<script type="text/javascript">
	function calculateLoanInterest() {
	  var loan_amount_for_interest = document.getElementById('loan-amount').value;
		var interest_rate = document.getElementById('loan-interest-rate').text();
		document.getElementById('loan-interest').innerHTML = loan_amount_for_interest * interest_rate;

	}
</script>
